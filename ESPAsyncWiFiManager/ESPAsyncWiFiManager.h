/**************************************************************
   WiFiManager is a library for the ESP8266/Arduino platform
   (https://github.com/esp8266/Arduino) to enable easy
   configuration and reconfiguration of WiFi credentials using a Captive Portal
   inspired by:
   http://www.esp8266.com/viewtopic.php?f=29&t=2520
   https://github.com/chriscook8/esp-arduino-apboot
   https://github.com/esp8266/Arduino/tree/esp8266/hardware/esp8266com/esp8266/libraries/DNSServer/examples/CaptivePortalAdvanced
   Built by AlexT https://github.com/tzapu
   Ported to Async Web Server by https://github.com/alanswx
   Licensed under MIT license
 **************************************************************/

#ifndef ESPAsyncWiFiManager_h
#define ESPAsyncWiFiManager_h

#if defined(ESP8266)
#include <ESP8266WiFi.h>          //https://github.com/esp8266/Arduino
#else
#include <WiFi.h>
#include "esp_wpa2.h"
#include "esp_wps.h"
#define ESP_WPS_MODE WPS_TYPE_PBC
#endif
#include <ESPAsyncWebServer.h>

//#define USE_EADNS               //Uncomment to use ESPAsyncDNSServer
#ifdef USE_EADNS
#include <ESPAsyncDNSServer.h>    //https://github.com/devyte/ESPAsyncDNSServer
                                  //https://github.com/me-no-dev/ESPAsyncUDP
#else
#include <DNSServer.h>
#endif
#include <memory>

#if defined(ESP8266)
extern "C" {
  #include "user_interface.h"
}
#else
#include <rom/rtc.h>
#endif

// const char WFM_HTTP_HEAD[] PROGMEM            = "<!DOCTYPE html><html lang=\"en\"><head><meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\"/><title>{v}</title>";
// const char HTTP_STYLE[] PROGMEM           = "<style>.c{text-align: center;} div,input{padding:5px;font-size:1em;} input{width:95%;} body{text-align: center;font-family:verdana;} button{border:0;border-radius:0.3rem;background-color:#1fa3ec;color:#fff;line-height:2.4rem;font-size:1.2rem;width:100%;} .q{float: right;width: 64px;text-align: right;} .l{background: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAALVBMVEX///8EBwfBwsLw8PAzNjaCg4NTVVUjJiZDRUUUFxdiZGSho6OSk5Pg4eFydHTCjaf3AAAAZElEQVQ4je2NSw7AIAhEBamKn97/uMXEGBvozkWb9C2Zx4xzWykBhFAeYp9gkLyZE0zIMno9n4g19hmdY39scwqVkOXaxph0ZCXQcqxSpgQpONa59wkRDOL93eAXvimwlbPbwwVAegLS1HGfZAAAAABJRU5ErkJggg==\") no-repeat left center;background-size: 1em;}</style>";
// const char HTTP_SCRIPT[] PROGMEM          = "<script>function c(l){document.getElementById('s').value=l.innerText||l.textContent;document.getElementById('p').focus();}</script>";
// const char HTTP_HEAD_END[] PROGMEM        = "</head><body><div style='text-align:left;display:inline-block;min-width:260px;'>";
// const char HTTP_PORTAL_OPTIONS[] PROGMEM  = "<form action=\"/wifi\" method=\"get\"><button>Configure WiFi</button></form><br/><form action=\"/0wifi\" method=\"get\"><button>Configure WiFi (No Scan)</button></form><br/><form action=\"/i\" method=\"get\"><button>Info</button></form><br/><form action=\"/r\" method=\"post\"><button>Reset</button></form>";
// const char HTTP_ITEM[] PROGMEM            = "<div><a href='#p' onclick='c(this)'>{v}</a>&nbsp;<span class='q {i}'>{r}%</span></div>";
// const char HTTP_FORM_START[] PROGMEM      = "<form method='get' action='wifisave'><input id='s' name='s' length=32 placeholder='SSID'><br/><input id='p' name='p' length=64 type='password' placeholder='password'><br/>";
// const char HTTP_FORM_PARAM[] PROGMEM      = "<br/><input id='{i}' name='{n}' length={l} placeholder='{p}' value='{v}' {c}>";
// const char HTTP_FORM_END[] PROGMEM        = "<br/><button type='submit'>save</button></form>";
// const char HTTP_SCAN_LINK[] PROGMEM       = "<br/><div class=\"c\"><a href=\"/wifi\">Scan</a></div>";
// const char HTTP_SAVED[] PROGMEM           = "<div>Credentials Saved<br />Trying to connect ESP to network.<br />If it fails reconnect to AP to try again</div>";
// const char HTTP_END[] PROGMEM             = "</div></body></html>";


const char WFM_HTTP_HEAD[] PROGMEM            = "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\"/><title>{v}</title>\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css\">";
const char HTTP_STYLE[] PROGMEM           = R"=====(<style>button,form ul li{cursor:pointer}.Rescan,button{text-decoration:none}<style> @import url(https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500);button:focus,input:focus{outline:0}button:hover{opacity:.8}button:active{opacity:.5}.l{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAALVBMVEX///8EBwfBwsLw8PAzNjaCg4NTVVUjJiZDRUUUFxdiZGSho6OSk5Pg4eFydHTCjaf3AAAAZElEQVQ4je2NSw7AIAhEBamKn97/uMXEGBvozkWb9C2Zx4xzWykBhFAeYp9gkLyZE0zIMno9n4g19hmdY39scwqVkOXaxph0ZCXQcqxSpgQpONa59wkRDOL93eAXvimwlbPbwwVAegLS1HGfZAAAAABJRU5ErkJggg==) left center no-repeat;background-size:1em;width:53px;text-align:right}.input .name,button{font-family:Montserrat,sans-serif;font-weight:300;width:100%}button{display:inline-block;background:#000;border:none;color:#fff;padding:10px 25px;font-size:18px;border-radius:6px;position:relative;letter-spacing:4.9px}.input .name{-webkit-appearance:none;-moz-appearance:none;appearance:none;border-top:none;border-right:none;border-left:none;font-size:16px;border-bottom:3px solid #ddd;margin:38px 0;height:33px;transition-duration:.6s}.light-font,.normal-font{font-family:Montserrat,sans-serif;font-size:27px;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:3px;text-align:left;color:#868686;margin:0}input[type=text]{color:#868686}input[type=password]:focus,input[type=text]:focus{border-bottom-color:#000}.light-font{font-weight:200;padding-left:0}.normal-font{font-weight:400}.Rescan,.info{font-family:Montserrat,sans-serif;font-style:normal;font-stretch:normal;line-height:1.39;letter-spacing:1.7px}.container{width:400px;position:fixed;top:49%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.step{position:relative;width:4px;height:26px;border-radius:3.5px;background-color:#bbb;margin:0 2px}.steps{position:fixed;bottom:23px;left:50%;transform:translateX(-50%);display:inline-flex}.step-one{transform:scaleY(1.3);background-color:#000;bottom:4px}.slider{overflow:hidden;width:1600px;-webkit-transition:.3s all ease;transition:.3s all ease;-webkit-transform:translate(0) scale(1);-ms-transform:translate(0) scale(1);transform:translate(0) scale(1)}.h.slider-four-active .step-one,.h.slider-four-active .step-three,.h.slider-three-active .step-one,.h.slider-three-active .step-two,.h.slider-two-active .step-one{-webkit-transform:scaleY(1);-ms-transform:scaleY(1);transform:scaleY(1);bottom:0;background-color:#bbb;-webkit-transition:.3s all ease;transition:.3s all ease}.h.slider-four-active .step-four,.h.slider-three-active .step-three,.h.slider-two-active .step-two{-webkit-transform:scaleY(1.3);-ms-transform:scaleY(1.3);transform:scaleY(1.3);bottom:4px;background-color:#000;-webkit-transition:.3s all ease;transition:.3s all ease}.container.slider-four-active .slider-one,.container.slider-four-active .slider-three,.container.slider-four-active .slider-two,.container.slider-one-active .slider-four,.container.slider-one-active .slider-three,.container.slider-one-active .slider-two,.container.slider-three-active .slider-four,.container.slider-three-active .slider-one,.container.slider-three-active .slider-two,.container.slider-two-active .slider-four,.container.slider-two-active .slider-one,.container.slider-two-active .slider-three{-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5)}.container.slider-four-active form ul li a{left:-800px}.slider-four,.slider-one,.slider-three,.slider-two{-webkit-transition:.3s all ease;transition:.3s all ease}.slider-ctr{width:100%;overflow:hidden}.slider-form{float:left;width:400px;height:435px;text-align:center}.container.center .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}.container.half .slider{-webkit-transform:translate(-800px);-ms-transform:translate(-800px);transform:translate(-800px)}.container.full .slider{-webkit-transform:translate(-1200px);-ms-transform:translate(-1200px);transform:translate(-1200px)}#s{border:none;padding-right:107px}form ul{margin-top:20px;height:184px;overflow:scroll;overflow-x:hidden;padding:0}form ul li:hover{background:#F8F8F8}form ul li p{font-family:Montserrat,sans-serif;font-weight:300;border:none;font-size:16px;transition-duration:.6s;color:#999;float:left;position:relative;left:16px;margin:0}.Rescan,.info{font-weight:400}.WiFiList{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.WiFiList:last-child{border-bottom:none}.notyping{position:fixed;width:100%;height:32px}.q{float:right;color:#999}.other-network,.radio{float:left}.radio{position:relative;left:4px}input[type=radio]:after,input[type=radio]:checked:after{width:20px;height:21px;border-radius:15px;top:-8px;left:-4px;position:relative;visibility:visible;display:inline-block;content:''}input[type=radio]:after{background-color:#bbb;border:2px solid #F8F8F8}input[type=radio]:checked:after{background-color:#000;border:2px solid #F8F8F8}.connecting,.lineInfo,.load-1{position:fixed}input[type=radio]:checked{color:#000;font-weight:400}.load-1{opacity:0;bottom:20px;left:50%;transform:translateX(-50%)}.line{display:inline-block;width:4px;height:26px;border-radius:15px;background-color:#bbb}.load-1 .line:nth-last-child(1){animation:loadingA 2s 1s infinite}.load-1 .line:nth-last-child(2){animation:loadingA 2s .75s infinite}.load-1 .line:nth-last-child(3){animation:loadingA 2s .5s infinite}.load-1 .line:nth-last-child(4){animation:loadingA 2s 0s infinite}@keyframes loadingA{0%,100%{transform:scaleY(1) translateY(0)}50%{transform:scaleY(1.3) translateY(-4px);background-color:#000}}@-webkit-keyframes loadingA{0%,100%{-webkit-transform:scaleY(1) translateY(0)}50%{-webkit-transform:scaleY(1.3) translateY(-4px);background-color:#000}}.connecting{left:-50%;top:-50%;transform:unset;z-index:-10;text-align:center;animation:loadingB 2s 0s infinite}@keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}@-webkit-keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}.lineInfo{width:80px;height:2px;background:#bbb;border:none;border-radius:0;left:0;top:85px}.info{margin:8px 0 0;text-align:left;color:#868686}.spinner{opacity:0;position:absolute;z-index:20;right:400px;stroke:#999;top:37px;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite}.EnterP,.Rescan,.ent{position:relative}@-webkit-keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;-webkit-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite}@-webkit-keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}.Rescan{text-align:center;color:#000;background:0 0;border-radius:0;border:none;padding:0;margin:0;top:-4px}.Rescan:hover{color:#999}.ent{left:-133px}.EnterP{left:-118px}@media screen and (max-width:445px){.ent,.slider-four,.slider-three,.slider-two{position:relative}.container,.slider-form{width:328px}.slider-two{left:72px}.slider-three{left:144px}.slider-four{left:216px}.spinner{right:0}.slider-four--Rescan{position:relative;left:72px!important}.ent{left:-96px}}@media screen and (max-width:320px){.EnterP,.ent,.slider-four,.slider-three,.slider-two{position:relative}.spinner{right:0}.container,.slider-form{width:290px}.slider-two{left:110px}.slider-three{left:220px}.slider-four{left:330px}.light-font,.normal-font{font-size:23px}.slider-four--Rescan{position:relative;left:110px}.ent{left:-85px}.EnterP{left:-74px}}.StopTabbing{position:absolute;height:80px;background-color:transparent;width:100%;z-index:-1}.third{top:-14px}.other{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.buttonEnterprise{top:8px}#eid{margin-bottom:0;display:none}.checkmark-circle{width:150px;height:150px;position:relative;display:inline-block;vertical-align:top;left:50%;transform:translateX(-50%)}.checkmark-circle .background{width:150px;height:150px;border-radius:50%;position:absolute;bottom:0}.checkmark-circle .checkmark{border-radius:5px}.checkmark-circle .checkmark.draw:after{-webkit-animation-delay:.1s;-moz-animation-delay:.1s;animation-delay:.1s;-webkit-animation-duration:1s;-moz-animation-duration:1s;animation-duration:1s;-webkit-animation-timing-function:ease;-moz-animation-timing-function:ease;animation-timing-function:ease;-webkit-animation-name:checkmark;-moz-animation-name:checkmark;animation-name:checkmark;-webkit-transform:scaleX(-1) rotate(135deg);-moz-transform:scaleX(-1) rotate(135deg);-ms-transform:scaleX(-1) rotate(135deg);-o-transform:scaleX(-1) rotate(135deg);transform:scaleX(-1) rotate(135deg);-webkit-animation-fill-mode:forwards;-moz-animation-fill-mode:forwards;animation-fill-mode:forwards}.checkmark-circle .checkmark:after{opacity:1;height:75px;width:37.5px;-webkit-transform-origin:left top;-moz-transform-origin:left top;-ms-transform-origin:left top;-o-transform-origin:left top;transform-origin:left top;border-right:9px solid #000;border-top:9px solid #000;border-radius:2.5px!important;content:'';left:25px;top:95px;position:absolute}@-webkit-keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}@-moz-keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}@keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}.positioning{position:absolute;top:50%;width:100%;transform:translateY(-50%)}</style>)=====";
const char HTTP_SCRIPT[] PROGMEM          = "    <script>\n\n    function a(t,l){\n\n        console.log(l);\n        document.querySelector('#s').value= l;\n        const radio = t.querySelector(\".radio\");\n\n        if (radio[0] !== event.target) {\n            radio.click();\n        }\n\n        const ent = document.querySelector(\".ent\");\n        const otherNetworkHeading = document.querySelector(\".other-network\");\n        const changeClasses = document.querySelector(\".change\");\n        const otherNetChange = document.querySelector(\".other-netChange\");\n        const thirdButton = document.querySelector(\".third\");\n        changeClasses.classList.add(\"light-font\");\n        changeClasses.classList.remove(\"name\");\n        otherNetworkHeading.style.display = \"none\";\n        otherNetworkHeading.style.cssFloat = \"unset\";\n        changeClasses.style.borderBottom = \"none\";\n        otherNetChange.style.display = \"unset\";\n        otherNetChange.style.cssFloat = \"left\";\n        ent.style.display = \"none\";\n        thirdButton.disabled = false;\n        thirdButton.addEventListener('click', (e) => {\n            e.preventDefault();\n            thirdButton.innerHTML = \"Saving...\";\n            setTimeout(function() {\n                ctr.classList.add(\"slider-four-active\");\n                ctr.classList.add(\"full\");\n                ctr.classList.remove(\"center\");\n                ctr.classList.remove(\"slider-three-active\");\n                ctr.classList.remove(\"slider-one-active\");\n                ctr.classList.remove(\"slider-two-active\");\n                ctr.classList.remove(\"half\");\n\n                ctrH.classList.add(\"slider-four-active\");\n                ctrH.classList.add(\"full\");\n                ctrH.classList.remove(\"center\");\n                ctrH.classList.remove(\"slider-three-active\");\n                ctrH.classList.remove(\"slider-one-active\");\n                ctrH.classList.remove(\"slider-two-active\");\n                ctrH.classList.remove(\"half\");\n            }, delayInMilliseconds);\n        });\n    }\n    function b(t){\n\n        document.querySelector('#s').value = \"\";\n        const radio = t.querySelector(\".radio\");\n\n        if (radio[0] !== event.target) {\n            radio.click();\n        }\n\n        const ent = document.querySelector(\".ent\");\n        const otherNetChange = document.querySelector(\".other-netChange\");\n        const otherNetworkHeading = document.querySelector(\".other-network\");\n        const changeClasses = document.querySelector(\".change\");\n        const thirdButton = document.querySelector(\".third\");\n        changeClasses.classList.add(\"name\");\n        changeClasses.classList.remove(\"light-font\");\n        changeClasses.style.borderBottom = \"3px solid #dddddd\";\n        changeClasses.style.marginBottom = \"0\";\n        otherNetworkHeading.style.display = \"unset\";\n        otherNetChange.style.display = \"none\";\n        ent.style.display = \"unset\";\n        thirdButton.disabled = false;\n        thirdButton.addEventListener('click', (e) => {\n            e.preventDefault();\n            thirdButton.innerHTML = \"Saving...\";\n            setTimeout(function() {\n                ctr.classList.add(\"slider-four-active\");\n                ctr.classList.add(\"full\");\n                ctr.classList.remove(\"center\");\n                ctr.classList.remove(\"slider-three-active\");\n                ctr.classList.remove(\"slider-one-active\");\n                ctr.classList.remove(\"slider-two-active\");\n                ctr.classList.remove(\"half\");\n\n                ctrH.classList.add(\"slider-four-active\");\n                ctrH.classList.add(\"full\");\n                ctrH.classList.remove(\"center\");\n                ctrH.classList.remove(\"slider-three-active\");\n                ctrH.classList.remove(\"slider-one-active\");\n                ctrH.classList.remove(\"slider-two-active\");\n                ctrH.classList.remove(\"half\");\n            }, delayInMilliseconds);\n        });\n\n    }\n\n    </script>";
const char HTTP_HEAD_END[] PROGMEM        = "</head><body>";
const char HTTP_BEGIN_HTML[] PROGMEM      = "   <h1 class=\"light-font connecting\">Connecting...</h1>\n    <div class=\"load-wrapp\">\n        <div class=\"load-1\">\n            <div class=\"line\"></div>\n            <div class=\"line\"></div>\n            <div class=\"line\"></div>\n            <div class=\"line\"></div>\n        </div>\n    </div>\n\n    <div class=\"h slider-one-active\">\n        <div class=\"steps\">\n            <div class=\"step step-one\">\n                <div class=\"liner\"></div>\n            </div>\n            <div class=\"step step-two\">\n                <div class=\"liner\"></div>\n            </div>\n            <div class=\"step step-three\">\n                <div class=\"liner\"></div>\n            </div>\n            <div class=\"step step-four\">\n                <div class=\"liner\"></div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"container slider-one-active\">\n\n    <div class=\"slider-ctr\">\n        <div class=\"slider\">\n            <section>\n                    <form class=\"slider-form slider-one\" action=\"\">\n                    <h1 class=\"light-font\">Hi there!</h1>\n                    <h1 class=\"normal-font\">What's your name?</h1>\n                        <label class=\"input\">\n                            <input type=\"text\" class=\"name Name\" placeholder=\"Name\" onblur=\"validateN()\" >\n                        </label>\n                        <br><br>\n                        <button class=\"first\" >Next</button>\n                    </form>\n            </section>\n\n            <section>\n                    <form class=\"slider-form slider-two b\" action=\"\">\n                        <h1 class=\"light-font\">Hello <span id=\"n\" class=\"yourname\"></span>,</h1>\n                        <h1 class=\"normal-font\">What's your E-mail?</h1>\n                        <label class=\"input\">\n                            <input type=\"text\" class=\"name Email\" placeholder=\"E-mail address\" onblur=\"validate()\" >\n                        </label>\n                        <br><br>\n                        <button class=\"second next\">Next</button>\n                    </form>\n            </section>\n\n            <section>\n                    <form class=\"slider-form slider-three\" action=\"/wifi\">\n                        <h1 class=\"light-font\">Great!</h1>\n                        <h1 class=\"normal-font\">Select your Wi-Fi</h1>\n                        <svg class=\"spinner\" width=\"25px\" height=\"25px\" viewBox=\"0 0 66 66\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <circle class=\"path\" fill=\"none\" stroke-width=\"6\" stroke-linecap=\"round\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                        </svg>\n                        <ul>\n                            <li class=\"other\" onclick='b(this)'>\n                                <label>\n                                    <input type=\"radio\" class=\"radio\" value=\"1\" name=\"fooby[1][]\" />\n                                    <p class=\"other-content\">Other network</p>&nbsp;<span class='q {i}'></span>\n                                </label>\n                            </li>";
const char HTTP_ITEM[] PROGMEM            = "                            <li class=\"WiFiList\" onclick='a(this, this.querySelector(\"p.content\").innerText)'>\n                                <label>\n                                    <input type=\"radio\" class=\"radio\" value=\"1\" name=\"fooby[1][]\" />\n                                    <p class=\"content\">{v}</p>&nbsp;<span class='q {i}'>{r}%</span>\n                                </label>\n                            </li>";
const char HTTP_WIFI_END[] PROGMEM        = "\n                        </ul>\n                        <br><br>\n                        <div class=\"StopTabbing\"></div>\n                        <button class=\"third next\" >Next</button>\n                        <br/><div class=\"c\"><button  onclick=\"btnSubmitRescan()\" type=\"button\" class=\"Rescan\">Rescan</button></div>\n                    </form>\n            </section>";
const char HTTP_FORM_START[] PROGMEM      = " <section>\n                <form class=\"slider-form slider-four\" method=\"get\" action=\"wifisave\">\n                    <h1 class=\"light-font ent\">Personal</h1><br>\n                    <h1 class=\"normal-font other-network\" >Other network</h1>\n                    <div class=\"notyping\"></div>\n                    <label class=\"input\">\n\n                        <input class=\"change light-font\" id='s' name='s' length=32 placeholder='Network Name'><br>\n                    </label>\n                    <h1 class=\"normal-font other-netChange\">Password</h1>\n                    <label class=\"input\">\n                        <input id='eid' name='eid' length=64 type=\"\" class=\"name \" placeholder=\"Username\">\n                    </label>\n                    <label class=\"input\">\n                        <input id='p'name='p' length=64 type=\"password\" class=\"name \" placeholder=\"password\">\n                    </label>\n                    <br><br>";
const char HTTP_FORM_PARAM[] PROGMEM      = "<br/><input id='{i}'name='{n}'length={l}placeholder='{p}'value='{v}' {c}>";
const char HTTP_FORM_BUTTON[] PROGMEM     = "<button onclick=\"btnSubmitOnClick()\" type=\"button\" class=\"fourth next\">Verify</button>\n                    <br/><div class=\"c\"><button type=\"button\" class=\"Rescan buttonEnterprise\">Use WPA2-Enterprise</button></div>";
const char HTTP_END_HTML[] PROGMEM        = "</form>\n</section>\n</div>\n</div>\n</div>";
const char HTTP_ACTION_SCRIPT[] PROGMEM   = "<script>\n    const firstButton = document.querySelector(\".first\");\n    const secondButton = document.querySelector(\".second\");\n    const thirdButton = document.querySelector(\".third\");\n    const fourthButton = document.querySelector(\".fourth\");\n    const rescanButton = document.querySelector(\".Rescan\");\n    const name = document.querySelector(\".name\");\n    const EnterpriseButton = document.querySelector(\".buttonEnterprise\");\n    const yourname = document.querySelector(\".yourname\");\n    let ctr = document.querySelector(\".container\");\n    let ctrH = document.querySelector(\".h\");\n    const delayInMilliseconds = 1000;\n\n    firstButton.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        firstButton.innerHTML = \"Saving...\";\n        setTimeout(function() {\n            ctr.classList.add(\"slider-two-active\");\n            ctr.classList.add(\"center\");\n            ctr.classList.remove(\"full\");\n            ctr.classList.remove(\"slider-one-active\");\n\n            ctrH.classList.add(\"slider-two-active\");\n            ctrH.classList.add(\"center\");\n            ctrH.classList.remove(\"full\");\n            ctrH.classList.remove(\"slider-one-active\");\n\n            if(name.value === \"\") {\n\n                yourname.innerHTML = \"Anonymous\";\n            }\n            else { yourname.innerHTML = name.value; }\n        }, delayInMilliseconds);\n    });\n\n    secondButton.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        secondButton.innerHTML = \"Saving...\";\n        setTimeout(function() {\n            ctr.classList.add(\"half\");\n            ctr.classList.add(\"slider-three-active\");\n            ctr.classList.remove(\"center\");\n            ctr.classList.remove(\"slider-two-active\");\n            ctr.classList.remove(\"slider-one-active\");\n\n            ctrH.classList.add(\"half\");\n            ctrH.classList.add(\"slider-three-active\");\n            ctrH.classList.remove(\"center\");\n            ctrH.classList.remove(\"slider-two-active\");\n            ctrH.classList.remove(\"slider-one-active\");\n        }, delayInMilliseconds);\n    });\n\n    thirdButton.addEventListener('click', (e) => {\n        thirdButton.disabled = false;\n        e.preventDefault();\n\n        thirdButton.innerHTML = \"Choose From List\";\n    });\n\n    function submitForm() { // submits form\n    document.querySelector(\".slider-four\").submit();\n    }\n    function btnSubmitOnClick()\n    {\n        if (document.querySelector(\".slider-four\")) {\n            setTimeout(\"submitForm()\", 2000); // set timout\n       }\n       document.querySelector(\".step-four\").style.transform = \"scaleY(1)\";\n        document.querySelector(\".step-four\").style.backgroundColor = \"#bbbbbb\";\n        document.querySelector(\".step-four\").style.transition = \".3s all ease\";\n        document.querySelector(\".step-four\").style.bottom = \"0\";\n        fourthButton.innerHTML = \"Saving...\";\n        setTimeout(function() {\n            document.querySelector(\".container\").style.opacity = \"0\";\n            document.querySelector(\".container\").style.transitionDuration = \"600ms\";\n            document.querySelector(\".h\").style.opacity = \"0\";\n            document.querySelector(\".load-1\").style.opacity = \"unset\";\n            document.querySelector(\".connecting\").style.opacity = \"0\";\n            document.querySelector(\".connecting\").style.left = \"50%\";\n            document.querySelector(\".connecting\").style.top = \"50%\";\n            document.querySelector(\".connecting\").style.transform = \"translate(-50%,-50%)\";\n            document.querySelector(\".connecting\").style.transitionDelay = \"600ms\";\n            e.submit();\n        }, delayInMilliseconds);\n    }\n\n    function submitRescan() { // submits form\n        document.querySelector(\".slider-three\").submit();\n    }\n    function btnSubmitRescan()\n    {\n        if (document.querySelector(\".slider-three\")) {\n            setTimeout(\"submitRescan()\", 1500); // set timout\n        }\n        document.querySelector(\".spinner\").style.opacity = 1;\n        document.querySelector(\".StopTabbing\").style.zIndex = 1;\n    }\n    const ent = document.querySelector(\".ent\");\n    EnterpriseButton.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        if(EnterpriseButton.innerHTML === \"Use Personal Network\"){\n            EnterpriseButton.innerHTML = \"Use Enterprise Network\";\n            document.querySelector(\"#eid\").style.display = \"none\";\n            document.querySelector(\".other-netChange\").innerHTML = \"Password\";\n            ent.innerHTML = \"Personal\";\n            ent.classList.remove(\"EnterP\");\n\n\n        }else{\n            EnterpriseButton.innerHTML = \"Use Personal Network\";\n            ent.innerHTML = \"Enterprise\";\n            document.querySelector(\"#eid\").style.display = \"unset\";\n            document.querySelector(\".other-netChange\").innerHTML = \"Enterprise\";\n            ent.classList.add(\"EnterP\");\n        }\n\n    });\n</script>";
const char HTTP_END[] PROGMEM             = "</body></html>";

const char HTTP_Connection_STYLE[] PROGMEM           = R"=====(<style>.input .name,button{font-family:Montserrat,sans-serif;font-weight:300;width:100%}.Rescan,button{text-decoration:none}<style> @import url(https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500);button:focus,input:focus{outline:0}button:hover{opacity:.8}button:active{opacity:.5}button{display:inline-block;background:#000;border:none;color:#fff;padding:10px 25px;font-size:18px;border-radius:6px;cursor:pointer;position:relative;letter-spacing:4.9px}.input .name{-webkit-appearance:none;-moz-appearance:none;appearance:none;border-top:none;border-right:none;border-left:none;font-size:16px;border-bottom:3px solid #ddd;margin:38px 0;height:33px;transition-duration:.6s}.light-font,.normal-font{font-family:Montserrat,sans-serif;font-size:27px;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:3px;text-align:left;color:#868686;margin:0}input[type=text]{color:#868686}input[type=password]:focus,input[type=text]:focus{border-bottom-color:#000}.light-font{font-weight:200;padding-left:0}.normal-font{font-weight:400}.Rescan,.info{font-family:Montserrat,sans-serif;font-style:normal;font-stretch:normal;line-height:1.39;letter-spacing:1.7px}.container{width:400px;position:fixed;top:49%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.step{position:relative;width:4px;height:26px;border-radius:3.5px;background-color:#bbb;margin:0 2px}.steps{position:fixed;bottom:23px;left:50%;transform:translateX(-50%);display:inline-flex}.step-one{transform:scaleY(1.3);background-color:#000;bottom:4px}.slider{overflow:hidden;width:1600px;-webkit-transition:.3s all ease;transition:.3s all ease;-webkit-transform:translate(0) scale(1);-ms-transform:translate(0) scale(1);transform:translate(0) scale(1)}.h.slider-four-active .step-one,.h.slider-four-active .step-three,.h.slider-three-active .step-one,.h.slider-three-active .step-two,.h.slider-two-active .step-one{-webkit-transform:scaleY(1);-ms-transform:scaleY(1);transform:scaleY(1);bottom:0;background-color:#bbb;-webkit-transition:.3s all ease;transition:.3s all ease}.h.slider-four-active .step-four,.h.slider-three-active .step-three,.h.slider-two-active .step-two{-webkit-transform:scaleY(1.3);-ms-transform:scaleY(1.3);transform:scaleY(1.3);bottom:4px;background-color:#000;-webkit-transition:.3s all ease;transition:.3s all ease}.container.slider-four-active .slider-one,.container.slider-four-active .slider-three,.container.slider-four-active .slider-two,.container.slider-one-active .slider-four,.container.slider-one-active .slider-three,.container.slider-one-active .slider-two,.container.slider-three-active .slider-four,.container.slider-three-active .slider-one,.container.slider-three-active .slider-two,.container.slider-two-active .slider-four,.container.slider-two-active .slider-one,.container.slider-two-active .slider-three{-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5)}.container.slider-four-active form ul li a{left:-800px}.slider-four,.slider-one,.slider-three,.slider-two{-webkit-transition:.3s all ease;transition:.3s all ease}.slider-ctr{width:100%;overflow:hidden}.slider-form{float:left;width:400px;height:435px;text-align:center}.container.center .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}.container.half .slider{-webkit-transform:translate(-800px);-ms-transform:translate(-800px);transform:translate(-800px)}.container.full .slider{-webkit-transform:translate(-1200px);-ms-transform:translate(-1200px);transform:translate(-1200px)}.container.RescanFull .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}#s{border:none;padding-right:107px}form ul{margin-top:20px;height:184px;overflow:scroll;overflow-x:hidden;padding:0}form ul li:hover{cursor:pointer;background:#F8F8F8}form ul li p{cursor:pointer;font-family:Montserrat,sans-serif;font-weight:300;border:none;font-size:16px;transition-duration:.6s;color:#999;float:left;position:relative;left:16px;margin:0}.Rescan,.info{font-weight:400}.WiFiList{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.WiFiList:last-child{border-bottom:none}.notyping{position:fixed;width:100%;height:32px}.q{float:right;color:#999}.other-network,.radio{float:left}.radio{position:relative;left:4px}input[type=radio]:after,input[type=radio]:checked:after{width:20px;height:21px;border-radius:15px;top:-8px;left:-4px;position:relative;visibility:visible;display:inline-block;content:''}input[type=radio]:after{background-color:#bbb;border:2px solid #fff}input[type=radio]:checked:after{background-color:#000;border:2px solid #fff}.connecting,.lineInfo,.load-1{position:fixed}input[type=radio]:checked p{color:#000;font-weight:400}.load-1{opacity:0;bottom:20px;left:50%;transform:translateX(-50%)}.line{display:inline-block;width:4px;height:26px;border-radius:15px;background-color:#bbb}.load-1 .line:nth-last-child(1){animation:loadingA 2s 1s infinite}.load-1 .line:nth-last-child(2){animation:loadingA 2s .75s infinite}.load-1 .line:nth-last-child(3){animation:loadingA 2s .5s infinite}.load-1 .line:nth-last-child(4){animation:loadingA 2s 0s infinite}@keyframes loadingA{0%,100%{transform:scaleY(1) translateY(0)}50%{transform:scaleY(1.3) translateY(-4px);background-color:#000}}@-webkit-keyframes loadingA{0%,100%{-webkit-transform:scaleY(1) translateY(0)}50%{-webkit-transform:scaleY(1.3) translateY(-4px);background-color:#000}}.connecting{left:-50%;top:-50%;transform:unset;z-index:-10;text-align:center;animation:loadingB 2s 0s infinite}@keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}@-webkit-keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}.lineInfo{width:80px;height:2px;background:#bbb;border:none;border-radius:0;left:0;top:85px}.info{margin:8px 0 0;text-align:left;color:#868686}.spinner{opacity:0;position:absolute;z-index:20;right:400px;stroke:#999;top:37px;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite}.EnterP,.Rescan,.ent{position:relative}.path,.pathCross{stroke-dashoffset:0}@-webkit-keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}.path{stroke-dasharray:187;-webkit-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite}@-webkit-keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}.Rescan{text-align:center;color:#000;background:0 0;border-radius:0;border:none;padding:0;margin:0;top:-4px}.Rescan:hover{color:#999}.ent{left:-133px}.EnterP{left:-118px}@media screen and (max-width:445px){.ent,.slider-four,.slider-three,.slider-two{position:relative}.container,.slider-form{width:328px}.slider-two{left:72px}.slider-four{left:216px}.spinner{right:0}.slider-four--Rescan{position:relative;left:72px!important}.ent{left:-96px}}@media screen and (max-width:320px){.EnterP,.ent,.slider-four,.slider-three,.slider-two{position:relative}.spinner{right:0}.container,.slider-form{width:290px}.slider-two{left:110px}.slider-four{left:330px}.light-font,.normal-font{font-size:23px}.slider-four--Rescan{position:relative;left:110px!important}.ent{left:-85px}.slider-three{left:0}.EnterP{left:-74px}}.StopTabbing{position:absolute;height:80px;background-color:transparent;width:100%;z-index:-1}.third{top:-14px}.other{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.buttonEnterprise{top:8px}#eid{margin-bottom:0;display:none}.l{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAALVBMVEX///8EBwfBwsLw8PAzNjaCg4NTVVUjJiZDRUUUFxdiZGSho6OSk5Pg4eFydHTCjaf3AAAAZElEQVQ4je2NSw7AIAhEBamKn97/uMXEGBvozkWb9C2Zx4xzWykBhFAeYp9gkLyZE0zIMno9n4g19hmdY39scwqVkOXaxph0ZCXQcqxSpgQpONa59wkRDOL93eAXvimwlbPbwwVAegLS1HGfZAAAAABJRU5ErkJggg==) left center no-repeat;background-size:1em;width:53px;text-align:right}.checkmark-circle,.checkmark-circle .background{width:150px;height:150px;bottom:0;position:absolute}.checkmark-circle{display:inline-block;vertical-align:top;left:50%;transform:translateX(-50%)}.checkmark-circle .background{border-radius:50%}.checkmark-circle .checkmark{border-radius:5px;transform:scale(.7)}.checkmark-circle .checkmark.draw:after{-webkit-animation-delay:.1s;-moz-animation-delay:.1s;animation-delay:.1s;-webkit-animation-duration:1s;-moz-animation-duration:1s;animation-duration:1s;-webkit-animation-timing-function:ease;-moz-animation-timing-function:ease;animation-timing-function:ease;-webkit-animation-name:checkmark;-moz-animation-name:checkmark;animation-name:checkmark;-webkit-transform:scaleX(-1) rotate(135deg);-moz-transform:scaleX(-1) rotate(135deg);-ms-transform:scaleX(-1) rotate(135deg);-o-transform:scaleX(-1) rotate(135deg);transform:scaleX(-1) rotate(135deg);-webkit-animation-fill-mode:forwards;-moz-animation-fill-mode:forwards;animation-fill-mode:forwards}.checkmark-circle .checkmark:after{opacity:1;height:75px;width:37.5px;-webkit-transform-origin:left top;-moz-transform-origin:left top;-ms-transform-origin:left top;-o-transform-origin:left top;transform-origin:left top;border-right:9px solid #000;border-top:9px solid #000;border-radius:2.5px!important;content:'';left:25px;top:95px;position:absolute}@-webkit-keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}@-moz-keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}@keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:37.5px;opacity:1}100%,40%{height:75px;width:37.5px;opacity:1}}.positioning{position:absolute;top:46%;width:100%;transform:translateY(-50%)}svg{width:100px;display:block;margin:40px auto 0}.pathCross{stroke-dasharray:1000}.pathCross.circle{-webkit-animation:dash .9s ease-in-out;animation:dash .9s ease-in-out}.pathCross.lineCross{stroke-dashoffset:1000;-webkit-animation:dash .9s .35s ease-in-out forwards;animation:dash .9s .35s ease-in-out forwards}.pathCross.check{stroke-dashoffset:-100;-webkit-animation:dash-check .9s .35s ease-in-out forwards;animation:dash-check .9s .35s ease-in-out forwards}p{text-align:center;margin:20px 0 60px;font-size:1.25em}p.success{color:#73AF55}p.error{color:#D06079}@-webkit-keyframes dash{0%{stroke-dashoffset:1000}100%{stroke-dashoffset:0}}@keyframes dash{0%{stroke-dashoffset:1000}100%{stroke-dashoffset:0}}@-webkit-keyframes dash-check{0%{stroke-dashoffset:-100}100%{stroke-dashoffset:900}}@keyframes dash-check{0%{stroke-dashoffset:-100}100%{stroke-dashoffset:900}}.cross{position:absolute;bottom:10px;left:50%;transform:translateX(-50%) scale(.8)}</style>)=====";
const char HTTP_connected[] PROGMEM                 = "<div class=\"container\">\n    <section style=\"    position: fixed;transform: translateY(-50%);\">\n        <form class=\"slider-form \" action=\"\">\n            <div class=\"positioning\">\n\n                <div class=\"notyping\"></div>\n                <input class=\"light-font \" id='s' name='s' length=32 placeholder='Network'><br>\n                <h1 class=\"normal-font\">Connected</h1>\n                <br><br>\n                <div class=\"lineInfo\"></div>\n                <p class=\"info\">Connect with your device to this Wi-Fi router, go to your browser and search for: http://bloom.local:443/ Or http://{n}:443/</p>\n\n            </div>\n\n        </form>\n\n    </section>\n\n</div>\n<div class=\"checkmark-circle\">\n    <div class=\"checkmark draw\"></div>\n</div>";
const char HTTP_notConnected[] PROGMEM              = "<div class=\"container\">\n<section style=\"position: fixed; transform: translateY(-50%);\">\n    <form class=\"slider-form try-again\" action=\"/wifi\">\n        <div class=\"notyping\"></div>\n        <input class=\"light-font \" id='s' name='s' length=32 placeholder='Network'><br>\n        <svg class=\"spinner\" width=\"25px\" height=\"25px\" viewBox=\"0 0 66 66\" style=\"right: 0;\" >\n            <circle class=\"path\" fill=\"none\" stroke-width=\"6\" stroke-linecap=\"round\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n        </svg>\n        <h1 class=\"normal-font\">Not Connected</h1>\n        <br><br>\n        <div class=\"StopTabbing\" style=\"position: absolute;height: 45px;width: 100%;z-index: -1;background-color: transparent;\"></div>\n        <button onclick=\"btnSubmitTryAgain()\" type=\"button\">Try again</button>\n    </form>\n</section>\n</div>\n<svg class=\"cross\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 130.2 130.2\">\n    <line class=\"pathCross lineCross\" fill=\"none\" stroke=\"#000000\" stroke-width=\"6\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" x1=\"34.4\" y1=\"37.9\" x2=\"95.8\" y2=\"92.3\"/>\n    <line class=\"pathCross lineCross\" fill=\"none\" stroke=\"#000000\" stroke-width=\"6\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" x1=\"95.8\" y1=\"38\" x2=\"34.4\" y2=\"92.2\"/>\n</svg>";
const char HTTP_notConnected_SCRIPT[] PROGMEM       = "<script>\n\n    function submitTryAgain() { // submits form\n        document.querySelector(\".try-again\").submit();\n    }\n    function btnSubmitTryAgain()\n    {\n        if (document.querySelector(\".try-again\")) {\n            setTimeout(\"submitTryAgain()\", 1500); // set timout\n        }\n        document.querySelector(\".spinner\").style.opacity = 1;\n        document.querySelector(\".StopTabbing\").style.zIndex = 1;\n    }\n</script>";

const char HTTP_RESCAN_STYLE[] PROGMEM              = R"=====(<style>.input .name,button{font-family:Montserrat,sans-serif;font-weight:300;width:100%}.Rescan,button{text-decoration:none}<style> @import url(https://fonts.googleapis.com/css?family=Montserrat:200,300,400,500);button:focus,input:focus{outline:0}button:hover{opacity:.8}button:active{opacity:.5}button{display:inline-block;background:#000;border:none;color:#fff;padding:10px 25px;font-size:18px;border-radius:6px;cursor:pointer;position:relative;letter-spacing:4.9px}.input .name{-webkit-appearance:none;-moz-appearance:none;appearance:none;border-top:none;border-right:none;border-left:none;font-size:16px;border-bottom:3px solid #ddd;margin:38px 0;height:33px;transition-duration:.6s}.light-font,.normal-font{font-family:Montserrat,sans-serif;font-size:27px;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:3px;text-align:left;color:#868686;margin:0}input[type=text]{color:#868686}input[type=password]:focus,input[type=text]:focus{border-bottom-color:#000}.light-font{font-weight:200;padding-left:0}.normal-font{font-weight:400}.Rescan,.info{font-family:Montserrat,sans-serif;font-style:normal;font-stretch:normal;line-height:1.39;letter-spacing:1.7px}.container{width:400px;position:fixed;top:49%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.step{position:relative;width:4px;height:26px;border-radius:3.5px;background-color:#bbb;margin:0 2px}.steps{position:fixed;bottom:23px;left:50%;transform:translateX(-50%);display:inline-flex}.step-one{transform:scaleY(1.3);background-color:#000;bottom:4px}.slider{overflow:hidden;width:1600px;-webkit-transition:.3s all ease;transition:.3s all ease;-webkit-transform:translate(0) scale(1);-ms-transform:translate(0) scale(1);transform:translate(0) scale(1)}.h.slider-four-active .step-one,.h.slider-four-active .step-three,.h.slider-three-active .step-one,.h.slider-three-active .step-two,.h.slider-two-active .step-one{-webkit-transform:scaleY(1);-ms-transform:scaleY(1);transform:scaleY(1);bottom:0;background-color:#bbb;-webkit-transition:.3s all ease;transition:.3s all ease}.h.slider-four-active .step-four,.h.slider-three-active .step-three,.h.slider-two-active .step-two{-webkit-transform:scaleY(1.3);-ms-transform:scaleY(1.3);transform:scaleY(1.3);bottom:4px;background-color:#000;-webkit-transition:.3s all ease;transition:.3s all ease}.container.slider-four-active .slider-one,.container.slider-four-active .slider-three,.container.slider-four-active .slider-two,.container.slider-one-active .slider-four,.container.slider-one-active .slider-three,.container.slider-one-active .slider-two,.container.slider-three-active .slider-four,.container.slider-three-active .slider-one,.container.slider-three-active .slider-two,.container.slider-two-active .slider-four,.container.slider-two-active .slider-one,.container.slider-two-active .slider-three{-webkit-transform:scale(.5);-ms-transform:scale(.5);transform:scale(.5)}.container.slider-four-active form ul li a{left:-800px}.slider-four,.slider-one,.slider-three,.slider-two{-webkit-transition:.3s all ease;transition:.3s all ease}.slider-ctr{width:100%;overflow:hidden}.slider-form{float:left;width:400px;height:435px;text-align:center}.container.center .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}.container.half .slider{-webkit-transform:translate(-800px);-ms-transform:translate(-800px);transform:translate(-800px)}.container.full .slider{-webkit-transform:translate(-1200px);-ms-transform:translate(-1200px);transform:translate(-1200px)}.container.RescanFull .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}#s{border:none;padding-right:107px}form ul{margin-top:20px;height:184px;overflow:scroll;overflow-x:hidden;padding:0}form ul li:hover{cursor:pointer;background:#F8F8F8}form ul li p{cursor:pointer;font-family:Montserrat,sans-serif;font-weight:300;border:none;font-size:16px;transition-duration:.6s;color:#999;float:left;position:relative;left:16px;margin:0}.Rescan,.info{font-weight:400}.WiFiList{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.WiFiList:last-child{border-bottom:none}.notyping{position:fixed;width:100%;height:32px}.q{float:right;color:#999}.other-network,.radio{float:left}.radio{position:relative;left:4px}input[type=radio]:after,input[type=radio]:checked:after{width:20px;height:21px;border-radius:15px;top:-8px;left:-4px;position:relative;content:'';visibility:visible;display:inline-block}input[type=radio]:after{background-color:#bbb;border:2px solid #fff}input[type=radio]:checked:after{background-color:#000;border:2px solid #fff}.connecting,.lineInfo,.load-1{position:fixed}input[type=radio]:checked p{color:#000;font-weight:400}.load-1{opacity:0;bottom:20px;left:50%;transform:translateX(-50%)}.line{display:inline-block;width:4px;height:26px;border-radius:15px;background-color:#bbb}.load-1 .line:nth-last-child(1){animation:loadingA 2s 1s infinite}.load-1 .line:nth-last-child(2){animation:loadingA 2s .75s infinite}.load-1 .line:nth-last-child(3){animation:loadingA 2s .5s infinite}.load-1 .line:nth-last-child(4){animation:loadingA 2s 0s infinite}@keyframes loadingA{0%,100%{transform:scaleY(1) translateY(0)}50%{transform:scaleY(1.3) translateY(-4px);background-color:#000}}@-webkit-keyframes loadingA{0%,100%{-webkit-transform:scaleY(1) translateY(0)}50%{-webkit-transform:scaleY(1.3) translateY(-4px);background-color:#000}}.connecting{left:-50%;top:-50%;transform:unset;z-index:-10;text-align:center;animation:loadingB 2s 0s infinite}@keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}@-webkit-keyframes loadingB{0%,100%{opacity:0}50%{opacity:1}}.lineInfo{width:80px;height:2px;background:#bbb;border:none;border-radius:0;left:0;top:85px}.info{margin:8px 0 0;text-align:left;color:#868686}.spinner{opacity:0;position:absolute;z-index:20;right:400px;stroke:#999;top:37px;-webkit-animation:rotator 1.4s linear infinite;animation:rotator 1.4s linear infinite}.EnterP,.Rescan,.ent{position:relative}@-webkit-keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes rotator{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;-webkit-transform-origin:center;transform-origin:center;-webkit-animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite;animation:dash 1.4s ease-in-out infinite,colors 5.6s ease-in-out infinite}@-webkit-keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}.Rescan{text-align:center;color:#000;background:0 0;border-radius:0;border:none;padding:0;margin:0;top:-4px}.Rescan:hover{color:#999}.ent{left:-133px}.EnterP{left:-118px}@media screen and (max-width:445px){.ent,.slider-four,.slider-three,.slider-two{position:relative}.container,.slider-form{width:328px}.slider-two{left:72px}.slider-four{left:216px}.spinner{right:0}.slider-four--Rescan{position:relative;left:72px!important}.ent{left:-96px}}@media screen and (max-width:320px){.EnterP,.ent,.slider-four,.slider-three,.slider-two{position:relative}.spinner{right:0}.container,.slider-form{width:290px}.slider-two{left:110px}.slider-four{left:330px}.light-font,.normal-font{font-size:23px}.slider-four--Rescan{position:relative;left:110px!important}.ent{left:-85px}.slider-three{left:0}.EnterP{left:-74px}}.StopTabbing{position:absolute;height:80px;background-color:transparent;width:100%;z-index:-1}.third{top:-14px}.other{border-bottom:1px solid #bbb;padding-top:10px;padding-bottom:10px;list-style:none}.buttonEnterprise{top:8px}#eid{margin-bottom:0;display:none}.l{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAALVBMVEX///8EBwfBwsLw8PAzNjaCg4NTVVUjJiZDRUUUFxdiZGSho6OSk5Pg4eFydHTCjaf3AAAAZElEQVQ4je2NSw7AIAhEBamKn97/uMXEGBvozkWb9C2Zx4xzWykBhFAeYp9gkLyZE0zIMno9n4g19hmdY39scwqVkOXaxph0ZCXQcqxSpgQpONa59wkRDOL93eAXvimwlbPbwwVAegLS1HGfZAAAAABJRU5ErkJggg==) left center no-repeat;background-size:1em;width:53px;text-align:right}</style><style>.container.RescanFull .slider{-webkit-transform:translate(-400px);-ms-transform:translate(-400px);transform:translate(-400px)}</style>)=====";
const char HTTP_RESCAN_SCRIPT[] PROGMEM             = "    <script>\n\n        function a(t,l){\n\n            console.log(l);\n            document.querySelector('#s').value= l;\n            const radio = t.querySelector(\".radio\");\n\n            if (radio[0] !== event.target) {\n                radio.click();\n            }\n\n            const ent = document.querySelector(\".ent\");\n            const otherNetworkHeading = document.querySelector(\".other-network\");\n            const changeClasses = document.querySelector(\".change\");\n            const otherNetChange = document.querySelector(\".other-netChange\");\n            const thirdButton = document.querySelector(\".third\");\n            changeClasses.classList.add(\"light-font\");\n            changeClasses.classList.remove(\"name\");\n            otherNetworkHeading.style.display = \"none\";\n            otherNetworkHeading.style.cssFloat = \"unset\";\n            changeClasses.style.borderBottom = \"none\";\n            otherNetChange.style.display = \"unset\";\n            otherNetChange.style.cssFloat = \"left\";\n            ent.style.display = \"none\";\n            thirdButton.disabled = false;\n            thirdButton.addEventListener('click', (e) => {\n                e.preventDefault();\n                thirdButton.innerHTML = \"Saving...\";\n                setTimeout(function() {\n                    ctr.classList.add(\"slider-four-active\");\n                    ctr.classList.add(\"RescanFull\");\n                    ctr.classList.remove(\"center\");\n                    ctr.classList.remove(\"slider-three-active\");\n                    ctr.classList.remove(\"slider-one-active\");\n                    ctr.classList.remove(\"slider-two-active\");\n                    ctr.classList.remove(\"half\");\n\n                    ctrH.classList.add(\"slider-four-active\");\n                    ctrH.classList.add(\"RescanFull\");\n                    ctrH.classList.remove(\"center\");\n                    ctrH.classList.remove(\"slider-three-active\");\n                    ctrH.classList.remove(\"slider-one-active\");\n                    ctrH.classList.remove(\"slider-two-active\");\n                    ctrH.classList.remove(\"half\");\n                }, delayInMilliseconds);\n            });\n        }\n        function b(t){\n\n            document.querySelector('#s').value = \"\";\n            const radio = t.querySelector(\".radio\");\n\n            if (radio[0] !== event.target) {\n                radio.click();\n            }\n\n            const ent = document.querySelector(\".ent\");\n            const otherNetChange = document.querySelector(\".other-netChange\");\n            const otherNetworkHeading = document.querySelector(\".other-network\");\n            const changeClasses = document.querySelector(\".change\");\n            const thirdButton = document.querySelector(\".third\");\n            changeClasses.classList.add(\"name\");\n            changeClasses.classList.remove(\"light-font\");\n            changeClasses.style.borderBottom = \"3px solid #dddddd\";\n            changeClasses.style.marginBottom = \"0\";\n            otherNetworkHeading.style.display = \"unset\";\n            otherNetworkHeading.style.cssFloat = \"left\";\n            otherNetChange.style.display = \"none\";\n            ent.style.display = \"unset\";\n            thirdButton.disabled = false;\n            thirdButton.addEventListener('click', (e) => {\n                e.preventDefault();\n                thirdButton.innerHTML = \"Saving...\";\n                setTimeout(function() {\n                    ctr.classList.add(\"slider-four-active\");\n                    ctr.classList.add(\"RescanFull\");\n                    ctr.classList.remove(\"center\");\n                    ctr.classList.remove(\"slider-three-active\");\n                    ctr.classList.remove(\"slider-one-active\");\n                    ctr.classList.remove(\"slider-two-active\");\n                    ctr.classList.remove(\"half\");\n\n                    ctrH.classList.add(\"slider-four-active\");\n                    ctrH.classList.add(\"RescanFull\");\n                    ctrH.classList.remove(\"center\");\n                    ctrH.classList.remove(\"slider-three-active\");\n                    ctrH.classList.remove(\"slider-one-active\");\n                    ctrH.classList.remove(\"slider-two-active\");\n                    ctrH.classList.remove(\"half\");\n                }, delayInMilliseconds);\n            });\n\n        }\n\n    </script>";
const char HTTP_RESCAN_BODY_BEGIN[] PROGMEM         = "<h1 class=\"light-font connecting\">Connecting...</h1>\n<div class=\"load-wrapp\">\n    <div class=\"load-1\">\n        <div class=\"line\"></div>\n        <div class=\"line\"></div>\n        <div class=\"line\"></div>\n        <div class=\"line\"></div>\n    </div>\n</div>\n\n<div class=\"h slider-three-active\">\n    <div class=\"steps\">\n        <div class=\"step step-one\">\n            <div class=\"liner\"></div>\n        </div>\n        <div class=\"step step-two\">\n            <div class=\"liner\"></div>\n        </div>\n        <div class=\"step step-three\">\n            <div class=\"liner\"></div>\n        </div>\n        <div class=\"step step-four\">\n            <div class=\"liner\"></div>\n        </div>\n    </div>\n</div>\n\n<div class=\"container slider-three-active\" style=\"overflow: hidden;\">\n <div class=\"slider\" style=\"width: 800px!important;\">\n    <div class=\"slider-ctr\">\n        <section>\n            <form class=\"slider-form slider-three\" action=\"/wifi\">\n                <h1 class=\"light-font\">Great!</h1>\n                <h1 class=\"normal-font\">Select your Wi-Fi</h1>\n                <svg class=\"spinner\" width=\"25px\" height=\"25px\" viewBox=\"0 0 66 66\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <circle class=\"path\" fill=\"none\" stroke-width=\"6\" stroke-linecap=\"round\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n                </svg>\n                <ul>\n                    <li class=\"other\" onclick='b(this)'>\n                        <label>\n                            <input type=\"radio\" class=\"radio\" value=\"1\" name=\"fooby[1][]\" />\n                            <p class=\"other-content\">Other network</p>&nbsp;<span class='q {i}'></span>\n                        </label>\n                    </li>";
const char HTTP_RESCAN_BODY_END[] PROGMEM           = "</ul>\n                <br><br>\n                <div class=\"StopTabbing\"></div>\n                <button class=\"third next\" >Next</button>\n                <br/><div class=\"c\"><button  onclick=\"btnSubmitRescan()\" type=\"button\" class=\"Rescan\">Rescan</button></div>\n            </form>\n        </section>";
const char HTTP_RESCAN_ACTION_SCRIPT[] PROGMEM      = "<script>\n    const thirdButton = document.querySelector(\".third\");\n    const fourthButton = document.querySelector(\".fourth\");\n    const EnterpriseButton = document.querySelector(\".buttonEnterprise\");\n    const yourname = document.querySelector(\".yourname\");\n    let ctr = document.querySelector(\".container\");\n    let ctrH = document.querySelector(\".h\");\n    const delayInMilliseconds = 1000;\n\n    thirdButton.addEventListener('click', (e) => {\n        thirdButton.disabled = false;\n        e.preventDefault();\n\n        thirdButton.innerHTML = \"Choose From List\";\n    });\n\n    function submitForm() { // submits form\n        document.querySelector(\".slider-four\").submit();\n    }\n    function btnSubmitOnClick()\n    {\n        if (document.querySelector(\".slider-four\")) {\n            setTimeout(\"submitForm()\", 2000); // set timout\n        }\n        document.querySelector(\".step-four\").style.transform = \"scaleY(1)\";\n        document.querySelector(\".step-four\").style.backgroundColor = \"#bbbbbb\";\n        document.querySelector(\".step-four\").style.transition = \".3s all ease\";\n        document.querySelector(\".step-four\").style.bottom = \"0\";\n        fourthButton.innerHTML = \"Saving...\";\n        setTimeout(function() {\n            document.querySelector(\".container\").style.opacity = \"0\";\n            document.querySelector(\".container\").style.transitionDuration = \"600ms\";\n            document.querySelector(\".h\").style.opacity = \"0\";\n            document.querySelector(\".load-1\").style.opacity = \"unset\";\n            document.querySelector(\".connecting\").style.opacity = \"0\";\n            document.querySelector(\".connecting\").style.left = \"50%\";\n            document.querySelector(\".connecting\").style.top = \"50%\";\n            document.querySelector(\".connecting\").style.transform = \"translate(-50%,-50%)\";\n            document.querySelector(\".connecting\").style.transitionDelay = \"600ms\";\n            e.submit();\n        }, delayInMilliseconds);\n    }\n\n    function submitRescan() { // submits form\n        document.querySelector(\".slider-three\").submit();\n    }\n    function btnSubmitRescan()\n    {\n        if (document.querySelector(\".slider-three\")) {\n            setTimeout(\"submitRescan()\", 1500); // set timout\n        }\n        document.querySelector(\".spinner\").style.opacity = 1;\n        document.querySelector(\".StopTabbing\").style.zIndex = 1;\n    }\n\n    const ent = document.querySelector(\".ent\");\n    EnterpriseButton.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        if(EnterpriseButton.innerHTML === \"Use Personal Network\"){\n            EnterpriseButton.innerHTML = \"Use Enterprise Network\";\n            document.querySelector(\"#eid\").style.display = \"none\";\n            document.querySelector(\".other-netChange\").innerHTML = \"Password\";\n            ent.innerHTML = \"Personal\";\n            ent.classList.remove(\"EnterP\");\n\n\n        }else{\n            EnterpriseButton.innerHTML = \"Use Personal Network\";\n            ent.innerHTML = \"Enterprise\";\n            document.querySelector(\"#eid\").style.display = \"unset\";\n            document.querySelector(\".other-netChange\").innerHTML = \"Enterprise\";\n            ent.classList.add(\"EnterP\");\n        }\n\n    });\n</script>";
const char HTTP_RESCAN_FORM_START[] PROGMEM         = " <section>\n            <form class=\"slider-form slider-four slider-four--Rescan\" method=\"get\" action=\"wifisave\">\n                <h1 class=\"light-font ent\">Personal</h1><br>\n                <h1 class=\"normal-font other-network\" style=\"float:left;\">Other network</h1>\n                <div class=\"notyping\"></div>\n                <label class=\"input\">\n\n                    <input class=\"change light-font\" id='s' name='s' length=32 placeholder='Network Name'><br>\n                </label>\n                <h1 class=\"normal-font other-netChange\">Password</h1>\n                <label class=\"input\">\n                    <input id='eid' name='eid' length=64 type=\"\" class=\"name \" placeholder=\"Username\">\n                </label>\n                <label class=\"input\">\n                    <input id='p'name='p' length=64 type=\"password\" class=\"name \" placeholder=\"password\">\n                </label>\n                <br><br>";
const char HTTP_RESCAN_FORM_BUTTON[] PROGMEM        = " <button onclick=\"btnSubmitOnClick()\" type=\"button\" class=\"fourth next\">Verify</button>\n                <br/><div class=\"c\"><button type=\"button\" class=\"Rescan buttonEnterprise\">Use WPA2-Enterprise</button></div>";
const char HTTP_RESCAN_END_HTML[] PROGMEM           = "</form>\n</section>\n</div>\n</div>\n</div>";




#define WIFI_MANAGER_MAX_PARAMS 10

class AsyncWiFiManagerParameter {
public:
  AsyncWiFiManagerParameter(const char *custom);
  AsyncWiFiManagerParameter(const char *id, const char *placeholder, const char *defaultValue, int length);
  AsyncWiFiManagerParameter(const char *id, const char *placeholder, const char *defaultValue, int length, const char *custom);

  const char *getID();
  const char *getValue();
  const char *getPlaceholder();
  int         getValueLength();
  const char *getCustomHTML();
private:
  const char *_id;
  const char *_placeholder;
  char       *_value;
  int         _length;
  const char *_customHTML;

  void init(const char *id, const char *placeholder, const char *defaultValue, int length, const char *custom);

  friend class AsyncWiFiManager;
};


class WiFiResult
{
public:
  bool duplicate;
  String SSID;
  uint8_t encryptionType;
  int32_t RSSI;
  uint8_t* BSSID;
  int32_t channel;
  bool isHidden;

  WiFiResult()
  {
  }


};

class AsyncWiFiManager
{
public:
  #ifdef USE_EADNS
  AsyncWiFiManager(AsyncWebServer * server, AsyncDNSServer *dns);
  #else
  AsyncWiFiManager(AsyncWebServer * server, DNSServer *dns);
  #endif

  void          scan();
  String        scanModal();
  void          loop();
  void          safeLoop();
  void          criticalLoop();
  String        infoAsString();

  boolean       autoConnect();
  boolean       autoConnect(char const *apName, char const *apPassword = NULL);

  //if you want to always start the config portal, without trying to connect first
  boolean       startConfigPortal(char const *apName, char const *apPassword = NULL);
  void startConfigPortalModeless(char const *apName, char const *apPassword);

  // get the AP name of the config portal, so it can be used in the callback
  String        getConfigPortalSSID();

  void          resetSettings();

  //sets timeout before webserver loop ends and exits even if there has been no setup.
  //usefully for devices that failed to connect at some point and got stuck in a webserver loop
  //in seconds setConfigPortalTimeout is a new name for setTimeout
  void          setConfigPortalTimeout(unsigned long seconds);
  void          setTimeout(unsigned long seconds);

  //sets timeout for which to attempt connecting, usefull if you get a lot of failed connects
  void          setConnectTimeout(unsigned long seconds);


  void          setDebugOutput(boolean debug);
  //defaults to not showing anything under 8% signal quality if called
  void          setMinimumSignalQuality(int quality = 8);
  //sets a custom ip /gateway /subnet configuration
  void          setAPStaticIPConfig(IPAddress ip, IPAddress gw, IPAddress sn);
  //sets config for a static IP
  void          setSTAStaticIPConfig(IPAddress ip, IPAddress gw, IPAddress sn, IPAddress dns1=(uint32_t)0x00000000, IPAddress dns2=(uint32_t)0x00000000);
  //called when AP mode and config portal is started
  void          setAPCallback( void (*func)(AsyncWiFiManager*) );
  //called when settings have been changed and connection was successful
  void          setSaveConfigCallback( void (*func)(void) );
  //adds a custom parameter
  void          addParameter(AsyncWiFiManagerParameter *p);
  //if this is set, it will exit after config, even if connection is unsucessful.
  void          setBreakAfterConfig(boolean shouldBreak);
  //if this is set, try WPS setup when starting (this will delay config portal for up to 2 mins)
  //TODO
  //if this is set, customise style
  void          setCustomHeadElement(const char* element);
  //if this is true, remove duplicated Access Points - defaut true
  void          setRemoveDuplicateAPs(boolean removeDuplicates);

private:
  #ifdef USE_EADNS
  AsyncDNSServer      *dnsServer;
  #else
  DNSServer      *dnsServer;
  #endif
  AsyncWebServer *server;


  boolean         _modeless;
  int             scannow;
  int             shouldscan;
  boolean         needInfo = true;

  //const int     WM_DONE                 = 0;
  //const int     WM_WAIT                 = 10;

  //const String  HTTP_HEAD = "<!DOCTYPE html><html lang=\"en\"><head><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><title>{v}</title>";

  void          setupConfigPortal();
#ifdef NO_EXTRA_4K_HEAP
  void          startWPS();
#endif
  String        pager;
  wl_status_t   wifiStatus;
  const char*   _apName                 = "no-net";
  const char*   _apPassword             = NULL;
  String        _ssid                   = "";
  String        _pass                   = "";
  String        _eid                    = "";
  unsigned long _configPortalTimeout    = 0;
  unsigned long _connectTimeout         = 0;
  unsigned long _configPortalStart      = 0;

  IPAddress     _ap_static_ip;
  IPAddress     _ap_static_gw;
  IPAddress     _ap_static_sn;
  IPAddress     _sta_static_ip;
  IPAddress     _sta_static_gw;
  IPAddress     _sta_static_sn;
  IPAddress     _sta_static_dns1= (uint32_t)0x00000000;
  IPAddress     _sta_static_dns2= (uint32_t)0x00000000;

  int           _paramsCount            = 0;
  int           _minimumQuality         = -1;
  boolean       _removeDuplicateAPs     = true;
  boolean       _shouldBreakAfterConfig = false;
#ifdef NO_EXTRA_4K_HEAP
  boolean       _tryWPS                 = false;
#endif
  const char*   _customHeadElement      = "";

  //String        getEEPROMString(int start, int len);
  //void          setEEPROMString(int start, int len, String string);

  int           status = WL_IDLE_STATUS;
  int           connectWifi(String ssid, String pass, String eid);
  uint8_t       waitForConnectResult();
  void          setInfo();

  String networkListAsString();

  void          handleRoot(AsyncWebServerRequest *);
  void          handleWifi(AsyncWebServerRequest*,boolean scan);
  void			handleWifiRescan(AsyncWebServerRequest*,boolean scan);
  void          handleWifiSave(AsyncWebServerRequest*);
  void          handleInfo(AsyncWebServerRequest*);
  void			resultPage(AsyncWebServerRequest*);
  void          handleReset(AsyncWebServerRequest*);
  void          handleNotFound(AsyncWebServerRequest*);
  void          handle204(AsyncWebServerRequest*);
  boolean       captivePortal(AsyncWebServerRequest*);

  // DNS server
  const byte    DNS_PORT = 53;

  //helpers
  int           getRSSIasQuality(int RSSI);
  boolean       isIp(String str);
  String        toStringIp(IPAddress ip);

  boolean       connect;
  boolean       _debug = true;

  WiFiResult    *wifiSSIDs;
  int           wifiSSIDCount;
  boolean       wifiSSIDscan;

  void (*_apcallback)(AsyncWiFiManager*) = NULL;
  void (*_savecallback)(void) = NULL;

  AsyncWiFiManagerParameter* _params[WIFI_MANAGER_MAX_PARAMS];

  template <typename Generic>
  void          DEBUG_WM(Generic text);

  template <class T>
  auto optionalIPFromString(T *obj, const char *s) -> decltype(  obj->fromString(s)  ) {
    return  obj->fromString(s);
  }
  auto optionalIPFromString(...) -> bool {
    DEBUG_WM("NO fromString METHOD ON IPAddress, you need ESP8266 core 2.1.0 or newer for Custom IP configuration to work.");
    return false;
  }
};

#endif
